<div class="modal-content modal-register" (click)="$event.stopPropagation()">
  <button class="close-btn" (click)="close.emit()">Ã—</button>
  <!-- Toast Message -->
  <div *ngIf="showToast" class="toast {{ toastType }}" (click)="closeToast()">
    <div class="toast-icon">
      <span *ngIf="toastType === 'success'">âœ“</span>
      <span *ngIf="toastType === 'error'">âœ•</span>
    </div>
    <div class="toast-message">{{ toastMessage }}</div>
    <button class="toast-close" (click)="closeToast(); $event.stopPropagation()">Ã—</button>
  </div>

  <!-- Columna Izquierda -->
  <div class="register-left">
    <div class="register-illustration">
      <svg viewBox="0 0 200 200" class="illustration-svg">
        <circle cx="60" cy="60" r="30" fill="#3B82F6" opacity="0.2" />
        <rect x="30" y="100" width="140" height="80" rx="10" fill="#3B82F6" opacity="0.3" />
        <circle cx="170" cy="30" r="15" fill="#3B82F6" />
        <rect x="20" y="20" width="40" height="50" rx="5" fill="#E0E7FF" />
      </svg>
    </div>
    <h3>Una cuenta, toda tu tienda</h3>
    <p class="register-subtitle">
      Â¡RegÃ­strate y consigue todo lo que necesitas desde un solo portal!
    </p>

    <ul class="benefits-list">
      <li>
        <span class="icon">ðŸ›’</span>
        <span>Compra tus componentes fÃ¡cilmente</span>
      </li>
      <li>
        <span class="icon">ðŸ“¦</span>
        <span>Haz seguimiento de tus pedidos</span>
      </li>
      <li>
        <span class="icon">ðŸ”„</span>
        <span>Gestiona cambios y devoluciones</span>
      </li>
      <li>
        <span class="icon">ðŸ“„</span>
        <span>Descarga tus facturas al instante</span>
      </li>
      <li>
        <span class="icon">ðŸ””</span>
        <span>Mantente informado de las Ãºltimas novedades</span>
      </li>
    </ul>
  </div>

  <!-- Columna Derecha -->
  <div class="register-right">
    <h2>Registrarse</h2>

    <!-- Mensajes globales -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="success-message">
      {{ successMessage }}
    </div>

    <form (ngSubmit)="onSubmit()" #registerForm="ngForm">
      <div class="form-grid">
        <!-- Nombres y Apellidos -->
        <div class="input-label">
          <label>Primer nombre*</label>
          <input
            type="text"
            [(ngModel)]="userForm.primerNombre"
            name="primerNombre"
            required
            maxlength="20"
            (blur)="validateField('primerNombre', userForm.primerNombre)"
            [class.error]="hasError('primerNombre')"
          />
          <div *ngIf="hasError('primerNombre')" class="field-error">
            {{ getError('primerNombre') }}
          </div>
        </div>

        <div class="input-label">
          <label>Segundo nombre</label>
          <input
            type="text"
            [(ngModel)]="userForm.segundoNombre"
            name="segundoNombre"
            maxlength="20"
            (blur)="validateField('segundoNombre', userForm.segundoNombre)"
            [class.error]="hasError('segundoNombre')"
          />
          <div *ngIf="hasError('segundoNombre')" class="field-error">
            {{ getError('segundoNombre') }}
          </div>
        </div>

        <div class="input-label">
          <label>Primer apellido*</label>
          <input
            type="text"
            [(ngModel)]="userForm.primerApellido"
            name="primerApellido"
            required
            maxlength="20"
            (blur)="validateField('primerApellido', userForm.primerApellido)"
            [class.error]="hasError('primerApellido')"
          />
          <div *ngIf="hasError('primerApellido')" class="field-error">
            {{ getError('primerApellido') }}
          </div>
        </div>

        <div class="input-label">
          <label>Segundo apellido</label>
          <input
            type="text"
            [(ngModel)]="userForm.segundoApellido"
            name="segundoApellido"
            maxlength="20"
            (blur)="validateField('segundoApellido', userForm.segundoApellido)"
            [class.error]="hasError('segundoApellido')"
          />
          <div *ngIf="hasError('segundoApellido')" class="field-error">
            {{ getError('segundoApellido') }}
          </div>
        </div>

        <!-- Correo -->
        <div class="input-label full-width">
          <label>Correo electrÃ³nico*</label>
          <input
            type="email"
            [(ngModel)]="userForm.correo"
            name="correo"
            required
            (blur)="validateField('correo', userForm.correo)"
            [class.error]="hasError('correo')"
          />
          <div *ngIf="hasError('correo')" class="field-error">
            {{ getError('correo') }}
          </div>
        </div>

        <!-- ContraseÃ±a -->
        <div class="input-label full-width">
          <label>ContraseÃ±a*</label>
          <input
            type="password"
            [(ngModel)]="userForm.password"
            name="password"
            required
            (blur)="validateField('password', userForm.password)"
            [class.error]="hasError('password')"
          />
          <div *ngIf="hasError('password')" class="field-error">
            {{ getError('password') }}
          </div>
          <small class="password-hint">
            MÃ­nimo 8 caracteres, una mayÃºscula, una minÃºscula, un nÃºmero y un carÃ¡cter especial
          </small>
        </div>

        <!-- Username -->
        <div class="input-label full-width">
          <label>Nombre de usuario*</label>
          <input
            type="text"
            [(ngModel)]="userForm.username"
            name="username"
            required
            maxlength="16"
            (blur)="validateField('username', userForm.username)"
            [class.error]="hasError('username')"
          />
          <div *ngIf="hasError('username')" class="field-error">
            {{ getError('username') }}
          </div>
          <small class="hint">4-16 caracteres, solo letras, nÃºmeros y _</small>
        </div>

        <!-- TelÃ©fono -->
        <div class="input-label full-width">
          <label>TelÃ©fono*</label>
          <input
            type="tel"
            [(ngModel)]="userForm.telefono"
            name="telefono"
            required
            (blur)="validateField('telefono', userForm.telefono)"
            [class.error]="hasError('telefono')"
            maxlength="10"
          />
          <div *ngIf="hasError('telefono')" class="field-error">
            {{ getError('telefono') }}
          </div>
          <small class="hint">Debe empezar con 3 y tener 10 dÃ­gitos</small>
        </div>

        <!-- DirecciÃ³n - Estructura Colombiana -->
        <div class="address-section full-width">
          <h4>DirecciÃ³n</h4>
          <div class="address-grid">
            <div class="input-label">
              <label>Tipo de vÃ­a*</label>
              <select [(ngModel)]="userForm.tipoDireccion" name="tipoDireccion" required>
                <option value="">Seleccione...</option>
                <option *ngFor="let tipo of tiposDireccion" [value]="tipo.value">
                  {{ tipo.label }}
                </option>
              </select>
            </div>

            <div class="input-label">
              <label>NÃºmero*</label>
              <input
                type="text"
                [(ngModel)]="userForm.numeroDireccion"
                name="numeroDireccion"
                required
                maxlength="10"
                (blur)="validateField('numeroDireccion', userForm.numeroDireccion)"
                [class.error]="hasError('numeroDireccion')"
              />
              <div *ngIf="hasError('numeroDireccion')" class="field-error">
                {{ getError('numeroDireccion') }}
              </div>
            </div>

            <div class="input-label">
              <label>Sufijo</label>
              <select [(ngModel)]="userForm.sufijoDireccion" name="sufijoDireccion">
                <option *ngFor="let sufijo of sufijosDireccion" [value]="sufijo.value">
                  {{ sufijo.label }}
                </option>
              </select>
            </div>

            <div class="input-label">
              <label># Cruce*</label>
              <input
                type="text"
                [(ngModel)]="userForm.numeroCruce"
                name="numeroCruce"
                required
                maxlength="10"
                (blur)="validateField('numeroCruce', userForm.numeroCruce)"
                [class.error]="hasError('numeroCruce')"
              />
              <div *ngIf="hasError('numeroCruce')" class="field-error">
                {{ getError('numeroCruce') }}
              </div>
            </div>

            <div class="input-label full-width">
              <label>Complemento (opcional)</label>
              <input
                type="text"
                [(ngModel)]="userForm.complementoDireccion"
                name="complementoDireccion"
                placeholder="Ej: Apartamento 201, Bloque 2, Casa 5B, etc."
                (blur)="validateField('complementoDireccion', userForm.complementoDireccion)"
                [class.error]="hasError('complementoDireccion')"
                maxlength="50"
              />
              <div *ngIf="hasError('complementoDireccion')" class="field-error">
                {{ getError('complementoDireccion') }}
              </div>
            </div>
          </div>

          <!-- Vista previa de la direcciÃ³n -->
          <div
            *ngIf="userForm.tipoDireccion && userForm.numeroDireccion && userForm.numeroCruce"
            class="address-preview"
          >
            <strong>Vista previa:</strong>
            {{ buildMainAddress() }}
          </div>
        </div>

        <!-- Departamento y Ciudad -->
        <div class="input-label">
          <label>Departamento*</label>
          <select
            [(ngModel)]="userForm.departamento"
            name="departamento"
            (change)="onDepartmentChange()"
            [disabled]="isLoadingDepartments"
            required
          >
            <option value="">
              {{ isLoadingDepartments ? 'Cargando...' : 'Seleccione' }}
            </option>
            <option *ngFor="let dept of departments" [value]="dept.id">
              {{ dept.name }}
            </option>
          </select>
        </div>

        <div class="input-label">
          <label>Ciudad*</label>
          <select
            [(ngModel)]="userForm.ciudad"
            name="ciudad"
            [disabled]="!userForm.departamento || isLoadingCities"
            required
          >
            <option value="">
              {{
                isLoadingCities
                  ? 'Cargando...'
                  : !userForm.departamento
                  ? 'Seleccione departamento'
                  : 'Seleccione'
              }}
            </option>
            <option *ngFor="let city of cities" [value]="city.id">
              {{ city.name }}
            </option>
          </select>
        </div>
      </div>

      <button type="submit" class="btn-registrarse" [disabled]="isSubmitting || hasFieldErrors()">
        {{ isSubmitting ? 'Registrando...' : 'Registrarse' }}
      </button>
    </form>
  </div>
</div>
