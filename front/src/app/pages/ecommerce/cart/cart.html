<div class="cart-container">
  <!-- Header -->
  <div class="cart-header">
    <button class="back-btn" (click)="goBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      <span>Volver a la tienda</span>
    </button>
    <h1>Mi Carrito</h1>
    <button 
      *ngIf="cartItems.length > 0" 
      class="clear-cart-btn" 
      (click)="clearCart()"
      [disabled]="loading">
      Vaciar carrito
    </button>
  </div>

  <!-- Toast Notification - DESACTIVADO para evitar conflicto con el toast del store -->


  <!-- Modal de Confirmación -->
  <div *ngIf="modal.show" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-icon">
          <span *ngIf="modal.type === 'delete'">🗑️</span>
          <span *ngIf="modal.type === 'clear'">🛒</span>
          <span *ngIf="modal.type === 'info'">ℹ️</span>
        </div>
        <h3 class="modal-title">{{ modal.title }}</h3>
      </div>
      
      <div class="modal-body">
        <p [innerHTML]="modal.message"></p>
      </div>
      
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">
          Cancelar
        </button>
        <button 
          class="btn-primary" 
          [class.btn-danger]="modal.type === 'delete' || modal.type === 'clear'"
          (click)="confirmAction()">
          {{ modal.type === 'delete' || modal.type === 'clear' ? 'Eliminar' : 'Confirmar' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Procesando...</p>
    </div>
  </div>

  <!-- Carrito Vacío -->
  <div *ngIf="!loading && cartItems.length === 0" class="empty-cart">
    <div class="empty-cart-icon">🛒</div>
    <h2>Tu carrito está vacío</h2>
    <p>¡Explora nuestros productos y agrega algunos items!</p>
    <button class="continue-shopping" (click)="goBack()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"></path>
      </svg>
      Continuar comprando
    </button>
  </div>

  <!-- Carrito con Items -->
  <div *ngIf="!loading && cartItems.length > 0" class="cart-content">
    <!-- Lista de Items -->
    <div class="cart-items">
      <div *ngFor="let item of cartItems" class="cart-item">
        <div class="item-image">
          <img [src]="item.proCode.proImg || 'assets/placeholder-product.jpg'" [alt]="item.proCode.proName">
        </div>
        
        <div class="item-details">
          <h3 class="item-name">{{ item.proCode.proName }}</h3>
          <p class="item-brand">{{ item.proCode.proMark }}</p>
          <p class="item-price">{{ formatPrice(item.sellingPrice ?? item.proCode.proPrice) }}</p>
        </div>

        <div class="item-actions">
          <div class="quantity-controls">
            <button 
              class="qty-btn" 
              (click)="decrementQuantity(item)"
              [disabled]="loading || item.quantity <= 1">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
            <span class="quantity">{{ item.quantity }}</span>
            <button 
              class="qty-btn" 
              (click)="incrementQuantity(item)"
              [disabled]="loading">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>

          <p class="item-subtotal">
            {{ formatPrice((item.sellingPrice ?? item.proCode.proPrice) * item.quantity) }}
          </p>

          <button 
            class="remove-btn" 
            (click)="removeItem(item)"
            [disabled]="loading"
            title="Eliminar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Resumen y Checkout -->
    <div class="cart-summary">
      <div class="summary-header">
        <h3>Resumen del Pedido</h3>
      </div>
      
      <div class="summary-details">
        <div class="summary-row">
          <span>Productos ({{ itemCount }})</span>
          <span>{{ formatPrice(totalAmount) }}</span>
        </div>
        <div class="summary-row">
          <span>Envío</span>
          <span class="free-shipping">Gratis</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-row total">
          <span>Total</span>
          <span class="total-amount">{{ formatPrice(totalAmount) }}</span>
        </div>
      </div>
      
      <button class="checkout-btn" (click)="proceedToCheckout()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"></path>
        </svg>
        Proceder al Checkout
      </button>
      
      <button class="continue-shopping-btn" (click)="goBack()">
        Continuar comprando
      </button>
    </div>
  </div>
</div>
