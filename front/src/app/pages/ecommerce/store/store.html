<!-- Toast Notification -->
<div *ngIf="toast.show" [class]="'toast-notification ' + toast.type">
  <p>{{ toast.message }}</p>
  <button (click)="closeToast()" class="toast-close">&times;</button>
</div>

<!-- Products Grid -->
<div class="products-grid">
  <div 
    class="product-card" 
    *ngFor="let item of filteredItems"
    (click)="viewProductDetail(item.invCode!)"
    role="button"
    tabindex="0"
    (keydown.enter)="viewProductDetail(item.invCode!)">

    <div class="product-image">
      <img 
        [src]="item.product.proImg || 'assets/placeholder-product.jpg'" 
        [alt]="item.product.proName"
        loading="lazy">
    </div>
   
    <div class="product-info">
      <h3 class="product-name">{{ item.product.proName }}</h3>
      <p class="product-description">{{ item.product.descript }}</p>
      <p class="product-mark">Marca: {{ item.product.proMark }}</p>
      <p class="product-type">Categor√≠a: {{ item.product.productType.typeName }}</p>
      
      <div class="product-footer">
        <span class="product-price">{{ formatPrice(item.sellingPrice) }}</span>
        
        <!-- Bot√≥n de carrito solo para CLIENT (no ADMIN) -->
        <button 
          *ngIf="!isAdmin && authService.isLoggedIn()"
          class="add-to-cart-btn"
          (click)="addToCart($event, item)"
          [disabled]="isLoadingProduct(item.invCode!)"
          [class.loading]="isLoadingProduct(item.invCode!)"
          type="button">
          
          <!-- Estado normal -->
          <span *ngIf="!isLoadingProduct(item.invCode!)" class="btn-content">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            Agregar
          </span>
          
          <!-- Estado loading -->
          <span *ngIf="isLoadingProduct(item.invCode!)" class="btn-content loading">
            <span class="spinner">‚è≥</span>
            A√±adiendo...
          </span>
        </button>

       

        
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay productos -->
  <div *ngIf="filteredItems.length === 0 && !loading" class="no-products-message">
    <div class="no-products-icon">üì¶</div>
    <h2>No hay productos disponibles</h2>
    <p *ngIf="selectedTypeId">No se encontraron productos en esta categor√≠a</p>
    <p *ngIf="!selectedTypeId">No hay productos disponibles en este momento</p>
    <button (click)="resetFilters()" class="btn-reset-filters">
      Ver todos los productos
    </button>
  </div>
</div>