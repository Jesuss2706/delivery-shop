<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="spinner"></div>
  <p>Cargando productos...</p>
</div>

<!-- Product List Container -->
<div class="list-container" *ngIf="!loading">
  <!-- Header -->
  <div class="header-section">
    <button type="button" class="back-button" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Volver
    </button>

    <div class="header-content">
      <h1>Gestión de Productos</h1>
      <p class="subtitle">Selecciona un producto para editarlo o cambiar su estado</p>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="products.length === 0">
    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20 13V7a2 2 0 0 0-2-2h-3V3H9v2H6a2 2 0 0 0-2 2v6H1v8h22v-8z"></path>
    </svg>
    <h3>No hay productos disponibles</h3>
    <p>Aún no has creado ningún producto</p>
  </div>

  <!-- Products Grid -->
  <div class="products-grid" *ngIf="products.length > 0">
    <div class="product-card" *ngFor="let product of products" [class.inactive]="product.status === 'I'">
      <!-- Status Badge -->
      <div class="status-badge" [class.active]="product.status === 'A'" [class.inactive]="product.status === 'I'">
        {{ product.status === 'A' ? 'Activo' : 'Inactivo' }}
      </div>

      <!-- Product Image -->
      <div class="product-image">
        <img [src]="product.proImg" [alt]="product.proName" />
        <span class="product-type">{{ product.productType.typeName }}</span>
      </div>

      <!-- Product Info -->
      <div class="product-info">
        <h3 class="product-name">{{ product.proName }}</h3>
        <p class="product-brand">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          {{ product.proMark }}
        </p>
        <p class="product-description">{{ product.descript }}</p>
        <div class="product-price">{{ formatPrice(product.proPrice) }}</div>
      </div>

      <!-- Actions -->
      <div class="product-actions">
        <button class="btn-edit" (click)="editProduct(product)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          Editar
        </button>
        
        <!-- Botón para activar/desactivar -->
        <button *ngIf="product.status === 'A'" 
                class="btn-deactivate" 
                (click)="confirmDelete(product)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
          </svg>
          Desactivar
        </button>
        
        <button *ngIf="product.status === 'I'" 
                class="btn-activate" 
                (click)="activateProduct(product)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          Activar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="cancelDelete()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <h2>¿Desactivar producto?</h2>
      <p>¿Estás seguro de que deseas desactivar <strong>{{ productToDelete?.proName }}</strong>? El producto ya no será visible en la tienda.</p>
    </div>

    <div class="modal-actions">
      <button class="btn-modal-cancel" (click)="cancelDelete()">
        Cancelar
      </button>
      <button class="btn-modal-deactivate" (click)="deleteProduct()">
        Desactivar
      </button>
    </div>
  </div>
</div>

<!-- Toast -->
<div *ngIf="showToast" class="toast" [ngClass]="toastType">
  <img
    *ngIf="toastType === 'success'"
    class="toast-icon"
    src="https://cdn-icons-png.flaticon.com/512/845/845646.png"
    alt="Éxito"
  />
  <img
    *ngIf="toastType === 'error'"
    class="toast-icon"
    src="https://cdn-icons-png.flaticon.com/512/463/463612.png"
    alt="Error"
  />
  <p>{{ toastMessage }}</p>
</div>